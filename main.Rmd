---
title: "Swiss Pollen Forecast Analysis"
author: "PollenDistributionSwiss Team"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

## Introduction

This R Markdown document showcases the **PollenDistributionSwiss** R package for analyzing pollen forecasts across Switzerland. The package provides functions to:

-   Fetch real-time pollen data from Google's Pollen API
-   Create beautiful visualizations on Swiss maps
-   Compare pollen levels between cities
-   Cache data to improve performance

## Setup

Load the package and required libraries:

```{r load_package}
# Load required libraries
#suppressPackageStartupMessages({
 # library(devtools)
  #library(dplyr)
  #library(ggplot2)
  #library(httr2)
  #library(readr)
  #library(tibble)
#})

# Load the PollenDistributionSwiss package
# devtools::load_all(".", quiet = TRUE)
# sf and terra needs to be insatlled a priori since the installation differs from win/mac/linux
install.packages("./PollenDistributionSwiss_0.1.0.tar.gz", repos = NULL, type = "source")

```

## Function 1: Get Pollen Forecast for Single Location

Fetch pollen data for Zurich using coordinates:

```{r get_single_forecast}
# Example coordinates for Zurich
latitude <- 47.3769
longitude <- 8.5417

# Get pollen forecast
zurich_pollen <- get_pollen_forecast(latitude, longitude)
print(zurich_pollen)
```

## Function 2: Get Pollen Forecast with Caching

Same data but with caching for improved performance:

```{r get_cached_forecast}
# Get pollen forecast with caching
zurich_cached <- get_pollen_forecast_with_cache(latitude, longitude)
print(zurich_cached)
```

## Function 3: Get Pollen Data for Multiple Swiss Cities

Retrieve pollen data for multiple cities at once:

```{r get_multiple_cities}
# List of Swiss cities
swiss_cities <- c("Zurich", "Geneva", "Bern", "Basel", "Lausanne")

# Get pollen data for all cities
cities_pollen <- get_pollin_for_list_cities(swiss_cities)
print(cities_pollen)
```

## Function 4: Compare Pollen Levels Between Cities

Compare pollen levels between Zurich and Geneva:

```{r compare_cities}
# Compare Zurich vs Geneva
comparison_result <- compare_pollen_levels(
  "Zurich", "Geneva", 
  47.3769, 8.5417,   # Zurich coordinates
  46.2044, 6.1432    # Geneva coordinates
)

cat("Comparison result:", comparison_result)
```

## Function 5: Visualize Grass Pollen Distribution

Create a map showing grass pollen levels across Swiss cantons:

```{r grass_pollen_map}
if(nrow(cities_pollen) > 0) {
  grass_plot <- average_pollen_by_canton(cities_pollen, pollen_type = "grass")
  print(grass_plot)
} else {
  cat("No data available for visualization")
}
```

## Function 6: Visualize Tree Pollen Distribution

Create a map showing tree pollen levels:

```{r tree_pollen_map}
if(nrow(cities_pollen) > 0) {
  tree_plot <- average_pollen_by_canton(cities_pollen, pollen_type = "tree")
  print(tree_plot)
}
```

## Function 7: Visualize Weed Pollen Distribution

Create a map showing weed pollen levels:

```{r weed_pollen_map}
if(nrow(cities_pollen) > 0) {
  weed_plot <- average_pollen_by_canton(cities_pollen, pollen_type = "weed")
  print(weed_plot)
}
```

## Function 8: Dominant Pollen Type by Canton

Show which pollen type is dominant in each canton:

```{r dominant_pollen_map}
if(nrow(cities_pollen) > 0) {
  dominant_plot <- plot_dominant_pollin(cities_pollen)
  print(dominant_plot)
}
```

## Summary Statistics

Display summary statistics from the collected data:

```{r summary_stats}
if(nrow(cities_pollen) > 0) {
  cat("=== POLLEN SUMMARY STATISTICS ===\n")
  cat("Cities analyzed:", nrow(cities_pollen), "\n")
  cat("Cantons covered:", n_distinct(cities_pollen$canton), "\n")
  cat("Average grass pollen:", round(mean(cities_pollen$grass_pollin, na.rm = TRUE), 2), "\n")
  cat("Average tree pollen:", round(mean(cities_pollen$tree_pollin, na.rm = TRUE), 2), "\n")
  cat("Average weed pollen:", round(mean(cities_pollen$weed_pollin, na.rm = TRUE), 2), "\n")
  
  # Find cities with highest pollen levels
  max_grass_city <- cities_pollen$city[which.max(cities_pollen$grass_pollin)]
  max_tree_city <- cities_pollen$city[which.max(cities_pollen$tree_pollin)]
  max_weed_city <- cities_pollen$city[which.max(cities_pollen$weed_pollin)]
  
  cat("Highest grass pollen in:", max_grass_city, "\n")
  cat("Highest tree pollen in:", max_tree_city, "\n")
  cat("Highest weed pollen in:", max_weed_city, "\n")
  cat("Data collected on:", Sys.Date(), "\n")
}
```

## Conclusion

The **PollenDistributionSwiss** package provides a comprehensive toolkit for analyzing pollen forecasts across Switzerland. It combines real-time API data with beautiful visualizations to help understand pollen distribution patterns.

### Key Features:

-   ✅ Real-time data from Google Pollen API
-   ✅ Smart caching for improved performance
-   ✅ Beautiful Swiss map visualizations
-   ✅ Multi-city data collection
-   ✅ Statistical analysis and comparisons
-   ✅ Support for grass, tree, and weed pollen types

### Use Cases:

-   Allergy research and monitoring
-   Public health analysis
-   Environmental studies
-   Personal allergy management

------------------------------------------------------------------------

*Package created for Data Hackathon 2025*
